<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.3.xsd">
	<form name="invoice-form" title="Invoice"
		model="com.axelor.apps.account.db.Invoice"
		onNew=""
		onLoad="action-account-invoice-onload-group"
		id="invoice-form-extend" extension="true">
		<extend
			target="panel-stack[@name='otherDetailsPanel']//panel[@name='referenceDocumentsPanel']">
			<insert position="before">
				<panel name="discountPanel" title="Global Discount"
					colSpan="12" itemSpan="6" canCollapse="true" collapseIf="true">
					<panel name="firstDiscountPanel"
						title="First global discount" colSpan="12">
						<field name="discountTypeSelect"
							onChange="action-invoice-method-compute-extend" canEdit="true" />
						<field name="discountAmount"
	onChange="action-invoice-method-compute-extend"
	hideIf="discountTypeSelect == 0" x-scale="2" />
					</panel>
					<panel name="secondDiscountPanel"
						title="Second global discount" colSpan="12">
						<field name="secDiscountTypeSelect"
							onChange="action-invoice-method-compute-extend" canEdit="true" />
						<field name="secDiscountAmount"
							onChange="action-invoice-method-compute-extend"
							hideIf="secDiscountTypeSelect == 0" x-scale="2" />
					</panel>
				</panel>
			</insert>
		</extend>
		<!-- just to be able to react on price list change to update global discount 
			amounts -->
		<extend
			target="panel[@name='mainPanel']//field[@name='priceList']">
			<replace>
				<field name="priceList" colSpan="3" canEdit="false"
					onChange="action-invoice-record-hide-discount,action-invoice-pricelist-method-extended"
					readonlyIf="statusSelect != 1"
					onSelect="action-invoice-method-domain-priceList"
					form-view="price-list-form" grid-view="price-list-grid" />
			</replace>
		</extend>
		
		<extend
			target="panel[@name='invoicingInfoPanel']//field[@name='partner']">
			<replace>
	            <field name="partner" colSpan="3" canEdit="false" 
		            readonlyIf="((operationTypeSelect == 3 || operationTypeSelect == 4) &amp;&amp; statusSelect != 1) || ((operationTypeSelect == 1 || operationTypeSelect == 2) &amp;&amp; (statusSelect != 1 || invoiceLineList.length > 0))"  
		            onChange="action-group-account-invoice-partner-onchange-extended,action-method-invoice-address-str" 
		            onSelect="action-invoice-method-set-partner-domain" 
		            form-view="partner-form" 
		            grid-view="partner-grid"/>
			</replace>
		</extend>
		
	</form>
	
	 <action-group name="action-group-account-invoice-partner-onchange-extended">
    	<action name="action-invoice-record-partner-change"/>
		  <action name="action-invoice-method-payment-mode-condition"/>
    	<action name="action-invoice-record-due-date"/>
    	<action name="action-invoice-record-estimated-payment-date"/>
			<action name="action-invoice-method-fill-company-bank-details"/>
			<action name="action-invoice-record-specific-note-on-invoice"/>
			<action name="action-invoice-method-fill-advance-payment-set"/>
			<action name="action-invoice-method-set-default-mail"/>
			<action name="action-invoice-method-fill-price-list-extended"/>
			<action name="action-invoice-attrs-interco-supplychain"/>
			<action name="action-invoice-record-interco-supplychain"/>
			<action name="action-invoice-method-check-partner-bank-details-list"/>
			<action name="action-invoice-method-set-pfp-validator-user"
        if="__config__.app.getApp('account').getActivatePassedForPayment() &amp;&amp; (company.accountConfig.isManagePassedForPayment &amp;&amp; (operationTypeSelect == 1 || company.accountConfig.isManagePFPInRefund &amp;&amp; operationTypeSelect == 2) ) "/>
      <action name="action-invoice-record-set-dummy-field-language"/>
    </action-group>
    
	<action-method
		name="action-invoice-method-compute-extend">
		<call
			class="bzh.toolapp.apps.remisecascade.web.InvoiceController"
			method="compute" />
	</action-method>

	<action-method
		name="action-invoice-pricelist-method-extended">
		<call
			class="bzh.toolapp.apps.remisecascade.web.InvoiceController"
			method="propagatePriceListDiscounts" />
	</action-method>
	
	<action-method name="action-invoice-method-fill-price-list-extended">
		<call class="bzh.toolapp.apps.remisecascade.web.InvoiceController"
			  method="fillPriceList"/>
	</action-method>
	
	
</object-views>